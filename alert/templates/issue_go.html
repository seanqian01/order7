{% extends "base.html" %}
{% block title %}
    批量自动新建任务--美速运营统计报表系统
{% endblock %}


{% block content %}
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">批量自动新建任务</h1>
      </div>
    <div>
        <form action="{% url 'add_issues' %}" method="post">
            {% csrf_token %}
            <div class="form-group col-2">
                    <label for="validationCustom04">任务所在阶段</label>
                      <select class="custom-select" id="trackers" name="tracker">
                      </select>
            </div>
            <div class="form-row">
                   <div class="form-group col-2">
                          <label for="templateType">任务类型</label>
                          <select class="custom-select" id="templateType" name="template_type">
                              <option selected>选择任务类型...</option>
                              <option value="1">一级任务</option>
                              <option value="2">二级任务</option>
                          </select>
                  </div>
                  <div class="form-group col-2" id="issueGroupDiv" style="display: none;">
                    <label for="issueGroup">任务组别</label>
                    <select class="custom-select" id="issueGroup" name="issue_group">
                        <option selected>选择任务组别...</option>
                        <option value="1">商务组</option>
                        <option value="2">DM组</option>
                        <option value="3">统计分析组</option>
                        <option value="4">编程组</option>
                        <option value="5">行政管理人员</option>

                    </select>
                </div>
          </div>
            <div class="form-group col-3">
                    <label for="inputissuesid">任务所属项目名称</label>
                    <input type="text" class="form-control" id="fromprojectid" name="fromprojectname">
                <small id="projectok" class="form-text text-muted">项目必须存在</small>
            </div>

            <div class="form-group col-3">
                    <label for="inputissuesid">所属上级任务ID</label>
                    <input type="text" class="form-control" id="fromissuesid" name="fromissuesid">
            </div>
            <div class="form-group col-3">
                    <label for="inputiuserid">任务计划完成日期</label>
                    <input type="text" class="form-control" id="plandatedone" name="plandatedone">
            </div>
            <div>
                <button type="submit" class="btn btn-primary" >提交生成批次任务</button>
            </div>

    </form>
    </div>
    </br>
{#    <div style="text-align: right">#}
{#    批次任务生成记录#}
{#    </div>#}
{#        <div>#}
{#            <table class="table table-striped">#}
{#          <thead>#}
{#            <tr>#}
{#              <th scope="col">序号</th>#}
{#              <th scope="col">批次号</th>#}
{#              <th scope="col">批次状态</th>#}
{#              <th scope="col">生成任务数量</th>#}
{#              <th scope="col">任务生成时间</th>#}
{#            </tr>#}
{#          </thead>#}
{#          <tbody>#}
{#            <tr>#}
{#              <th scope="row">1</th>#}
{#              <td>2023102601</td>#}
{#              <td>已生成</td>#}
{#              <td>12</td>#}
{#              <td>2023-10-26 18:24:16</td>#}
{#            </tr>#}
{#          </tbody>#}
{#        </table>#}
{#    </div>#}

{% endblock %}

{% block script %}
<script>
    // 当前页面路径
    var current = location.pathname;

    $(function() {
      // 导航栏切换
      $('.nav-item a').each(function(){
        var $this = $(this);
        if($this.attr('href') === current){
          $this.addClass('active');
        }
      })
    });

    $.get('/load_trackers/', function(data) {
      var options = data.trackers.map(t => `<option>${t}</option>`);
      $('#trackers').html(options);
    });

      $('#templateType').change(function() {
        var templateType = $(this).val();
        var issueGroupDiv = $('#issueGroupDiv');
        var issueGroupSelect = $('#issueGroup');

        // 如果是二级任务，显示任务组别选择
        if (templateType === '2') {
            issueGroupDiv.show();
        } else {
            // 如果不是二级任务，隐藏任务组别选择并清除已选择的值
            issueGroupDiv.hide();
            issueGroupSelect.val(''); // 清除选择的值，确保不会发送到后端
        }
    });

        // 页面加载完成后，根据当前任务类型的选择设置任务组别选择的显示状态
      $(document).ready(function() {
            $('#templateType').trigger('change'); // 触发 change 事件以设置初始状态
      });

  </script>
{% endblock %}
